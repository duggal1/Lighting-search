(()=>{var e={};e.id=280,e.ids=[280],e.modules={20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{"use strict";e.exports=require("crypto")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},6005:e=>{"use strict";e.exports=require("node:crypto")},85477:e=>{"use strict";e.exports=require("punycode")},12781:e=>{"use strict";e.exports=require("stream")},57310:e=>{"use strict";e.exports=require("url")},59796:e=>{"use strict";e.exports=require("zlib")},56897:(e,t,r)=>{"use strict";r.r(t),r.d(t,{originalPathname:()=>K,patchFetch:()=>T,requestAsyncStorage:()=>E,routeModule:()=>P,serverHooks:()=>A,staticGenerationAsyncStorage:()=>_});var a={};r.r(a),r.d(a,{POST:()=>k});var i=r(72876),n=r(82525),s=r(50567),o=r(99560),c=r(12995),l=r(70186),u=r(84744),h=r(46600),d=r(18118),p=r(44862),m=r(6936);class f extends p.eq{constructor(e){super(e),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.callbacks=e?.callbacks,this.tags=e?.tags??[],this.metadata=e?.metadata??{},this.verbose=e?.verbose??!1}_getRelevantDocuments(e,t){throw Error("Not implemented!")}async invoke(e,t){return this.getRelevantDocuments(e,(0,m.LE)(t))}async getRelevantDocuments(e,t){let r=(0,m.LE)((0,d.QH)(t)),a=await d.Ye.configure(r.callbacks,this.callbacks,r.tags,this.tags,r.metadata,this.metadata,{verbose:this.verbose}),i=await a?.handleRetrieverStart(this.toJSON(),e,r.runId,void 0,void 0,void 0,r.runName);try{let t=await this._getRelevantDocuments(e,i);return await i?.handleRetrieverEnd(t),t}catch(e){throw await i?.handleRetrieverError(e),e}}}var b=r(74157);class y extends f{static lc_name(){return"VectorStoreRetriever"}get lc_namespace(){return["langchain_core","vectorstores"]}_vectorstoreType(){return this.vectorStore._vectorstoreType()}constructor(e){super(e),Object.defineProperty(this,"vectorStore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"k",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(this,"searchType",{enumerable:!0,configurable:!0,writable:!0,value:"similarity"}),Object.defineProperty(this,"searchKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.vectorStore=e.vectorStore,this.k=e.k??this.k,this.searchType=e.searchType??this.searchType,this.filter=e.filter,"mmr"===e.searchType&&(this.searchKwargs=e.searchKwargs)}async _getRelevantDocuments(e,t){if("mmr"===this.searchType){if("function"!=typeof this.vectorStore.maxMarginalRelevanceSearch)throw Error(`The vector store backing this retriever, ${this._vectorstoreType()} does not support max marginal relevance search.`);return this.vectorStore.maxMarginalRelevanceSearch(e,{k:this.k,filter:this.filter,...this.searchKwargs},t?.getChild("vectorstore"))}return this.vectorStore.similaritySearch(e,this.k,this.filter,t?.getChild("vectorstore"))}async addDocuments(e,t){return this.vectorStore.addDocuments(e,t)}}class g extends b.i{constructor(e,t){super(t),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","vectorstores",this._vectorstoreType()]}),Object.defineProperty(this,"embeddings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.embeddings=e}async delete(e){throw Error("Not implemented.")}async similaritySearch(e,t=4,r,a){return(await this.similaritySearchVectorWithScore(await this.embeddings.embedQuery(e),t,r)).map(e=>e[0])}async similaritySearchWithScore(e,t=4,r,a){return this.similaritySearchVectorWithScore(await this.embeddings.embedQuery(e),t,r)}static fromTexts(e,t,r,a){throw Error("the Langchain vectorstore implementation you are using forgot to override this, please report a bug")}static fromDocuments(e,t,r){throw Error("the Langchain vectorstore implementation you are using forgot to override this, please report a bug")}asRetriever(e,t,r,a,i,n){if("number"==typeof e)return new y({vectorStore:this,k:e,filter:t,tags:[...a??[],this._vectorstoreType()],metadata:i,verbose:n,callbacks:r});{let t={vectorStore:this,k:e?.k,filter:e?.filter,tags:[...e?.tags??[],this._vectorstoreType()],metadata:e?.metadata,verbose:e?.verbose,callbacks:e?.callbacks,searchType:e?.searchType};return new y(e?.searchType==="mmr"?{...t,searchKwargs:e.searchKwargs}:{...t})}}}var v=r(65036),w=r(33895),x=r(86570);function j(e,t){let r=0,a=0,i=0;for(let n=0;n<e.length;n++)r+=e[n]*t[n],a+=e[n]*e[n],i+=t[n]*t[n];return r/(Math.sqrt(a)*Math.sqrt(i))}function O(e,t,r){if(0===e.length||0===e[0].length||0===t.length||0===t[0].length)return[[]];if(e[0].length!==t[0].length)throw Error(`Number of columns in X and Y must be the same. X has shape ${[e.length,e[0].length]} and Y has shape ${[t.length,t[0].length]}.`);return e.map(e=>t.map(t=>r(e,t)).map(e=>Number.isNaN(e)?0:e))}class S extends g{_vectorstoreType(){return"pinecone"}constructor(e,t){super(e,t),Object.defineProperty(this,"textKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"namespace",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"pineconeIndex",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.embeddings=e;let{namespace:r,pineconeIndex:a,textKey:i,filter:n,pineconeConfig:s,...o}=t;if(this.namespace=r,!a&&!s)throw Error("pineconeConfig or pineconeIndex must be provided.");if(a&&s)throw Error("Only one of pineconeConfig or pineconeIndex can be provided.");a?this.pineconeIndex=a:s&&(this.pineconeIndex=new c.Index(s.indexName,{...s.config,sourceTag:"langchainjs"},s.namespace,s.indexHostUrl,s.additionalHeaders)),this.textKey=i??"text",this.filter=n,this.caller=new w.L(o)}async addDocuments(e,t){let r=e.map(({pageContent:e})=>e);return this.addVectors(await this.embeddings.embedDocuments(r),e,t)}async addVectors(e,t,r){let a=Array.isArray(r)?r:r?.ids,i=null==a?t.map(()=>u.Z()):a,n=e.map((e,r)=>{let a={...t[r].metadata},n={};for(let e of Object.keys(a))Array.isArray(a[e])&&a[e].every(e=>"string"==typeof e)&&(n[e]=a[e],delete a[e]);let s={...h(a),...n,[this.textKey]:t[r].pageContent};for(let e of Object.keys(s))null==s[e]?delete s[e]:"object"==typeof s[e]&&0===Object.keys(s[e]).length&&delete s[e];return{id:i[r],metadata:s,values:e}}),s=!Array.isArray(r)&&r?.namespace?r.namespace:this.namespace,o=this.pineconeIndex.namespace(s??""),c=(0,x.F)(n,100).map(e=>this.caller.call(async()=>o.upsert(e)));return await Promise.all(c),i}async delete(e){let{deleteAll:t,ids:r,filter:a}=e,i=e.namespace??this.namespace,n=this.pineconeIndex.namespace(i??"");if(t)await n.deleteAll();else if(r)for(let e=0;e<r.length;e+=1e3){let t=r.slice(e,e+1e3);await n.deleteMany(t)}else if(a)await n.deleteMany(a);else throw Error("Either ids or delete_all must be provided.")}async _runPineconeQuery(e,t,r,a){if(r&&this.filter)throw Error("cannot provide both `filter` and `this.filter`");let i=r??this.filter,n=this.namespace??"";i&&"namespace"in i&&(n=i.namespace,delete i.namespace);let s=this.pineconeIndex.namespace(n??"");return await s.query({includeMetadata:!0,topK:t,vector:e,filter:i,...a})}async similaritySearchVectorWithScore(e,t,r){let a=await this._runPineconeQuery(e,t,r),i=[];if(a.matches)for(let e of a.matches){let{[this.textKey]:t,...r}=e.metadata??{};e.score&&i.push([new v.BB({metadata:r,pageContent:t}),e.score])}return i}async maxMarginalRelevanceSearch(e,t){let r=await this.embeddings.embedQuery(e),a=await this._runPineconeQuery(r,t.fetchK??20,t.filter,{includeValues:!0}),i=a?.matches??[],n=(function(e,t,r=.5,a=4){if(0>=Math.min(a,t.length))return[];let i=O(Array.isArray(e[0])?e:[e],t,j)[0],n=function(e){if(0===e.length)return{maxIndex:-1,maxValue:NaN};let t=e[0],r=0;for(let a=1;a<e.length;a+=1)e[a]>t&&(r=a,t=e[a]);return{maxIndex:r,maxValue:t}}(i).maxIndex,s=[t[n]],o=[n];for(;o.length<Math.min(a,t.length);){let e=-1/0,a=-1,n=O(t,s,j);i.forEach((t,i)=>{if(o.includes(i))return;let s=r*t-(1-r)*Math.max(...n[i]);s>e&&(e=s,a=i)}),s.push(t[a]),o.push(a)}return o})(r,i.map(e=>e.values),t.lambda,t.k).map(e=>i[e]),s=[];for(let e of n){let{[this.textKey]:t,...r}=e.metadata??{};e.score&&s.push(new v.BB({metadata:r,pageContent:t}))}return s}static async fromTexts(e,t,r,a){let i=[];for(let r=0;r<e.length;r+=1){let a=Array.isArray(t)?t[r]:t,n=new v.BB({pageContent:e[r],metadata:a});i.push(n)}let n={pineconeIndex:a.pineconeIndex,textKey:a.textKey,namespace:a.namespace};return S.fromDocuments(i,r,n)}static async fromDocuments(e,t,r){r.textKey=r.textKey??"text";let a=new this(t,r);return await a.addDocuments(e),a}static async fromExistingIndex(e,t){return new this(e,t)}}async function k(e){let{query:t}=await e.json();if(!t)return o.NextResponse.json({error:"Query is required"},{status:400});try{let e=new c.Pinecone({apiKey:process.env.PINECONE_API_KEY}),r=new l.O({apiKey:process.env.VOYAGE_API_KEY,inputType:"query",modelName:"voyage-3"}),a=new S(r,{pineconeIndex:e.Index(process.env.PINECONE_INDEX)});console.log(`query is: ${t}`);let i=Date.now(),n=await a.maxMarginalRelevanceSearch(t,{k:1e3,fetchK:1e4,lambda:.8}),s=Date.now(),u=n.filter((e,t)=>t===n.findIndex(t=>e.metadata.id===t.metadata.id));return o.NextResponse.json({results:u,metadata:{totalResults:u.length,timeTaken:`${s-i} ms`}},{status:200})}catch(e){return console.error("Error performing similarity search:",e),o.NextResponse.json({error:"Failed to perform similarity search"},{status:500})}}let P=new i.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/search/route",pathname:"/api/search",filename:"route",bundlePath:"app/api/search/route"},resolvedPagePath:"/Users/harshitduggal/Downloads/thunder-search-1/src/app/api/search/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:E,staticGenerationAsyncStorage:_,serverHooks:A}=P,K="/api/search/route";function T(){return(0,s.patchFetch)({serverHooks:A,staticGenerationAsyncStorage:_})}},46600:e=>{function t(e){return e&&e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}function r(e){return e}function a(e,a){let i=(a=a||{}).delimiter||".",n=a.maxDepth,s=a.transformKey||r,o={};return function e(r,c,l){l=l||1,Object.keys(r).forEach(function(u){let h=r[u],d=a.safe&&Array.isArray(h),p=Object.prototype.toString.call(h),m=t(h),f=c?c+i+s(u):s(u);if(!d&&!m&&("[object Object]"===p||"[object Array]"===p)&&Object.keys(h).length&&(!a.maxDepth||l<n))return e(h,f,l+1);o[f]=h})}(e),o}e.exports=a,a.flatten=a,a.unflatten=function e(i,n){let s=(n=n||{}).delimiter||".",o=n.overwrite||!1,c=n.transformKey||r,l={};if(t(i)||"[object Object]"!==Object.prototype.toString.call(i))return i;function u(e){let t=Number(e);return isNaN(t)||-1!==e.indexOf(".")||n.object?e:t}return Object.keys(i=Object.keys(i).reduce(function(e,t){var r;let o=Object.prototype.toString.call(i[t]);return!("[object Object]"===o||"[object Array]"===o)||function(e){let t=Object.prototype.toString.call(e);return!e||("[object Array]"===t?!e.length:"[object Object]"===t?!Object.keys(e).length:void 0)}(i[t])?(e[t]=i[t],e):Object.keys(r=a(i[t],n)).reduce(function(e,a){return e[t+s+a]=r[a],e},e)},{})).forEach(function(t){let r=t.split(s).map(c),a=u(r.shift()),h=u(r[0]),d=l;for(;void 0!==h;){if("__proto__"===a)return;let e=Object.prototype.toString.call(d[a]),t="[object Object]"===e||"[object Array]"===e;if(!o&&!t&&void 0!==d[a])return;(!o||t)&&(o||null!=d[a])||(d[a]="number"!=typeof h||n.object?{}:[]),d=d[a],r.length>0&&(a=u(r.shift()),h=u(r[0]))}d[a]=e(i[t],n)}),l}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[253,881],()=>r(56897));module.exports=a})();